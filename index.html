<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ù…Ø³ØªØ¹Ø±Ø¶ Ù…Ù„ÙØ§Øª Ù…Ø¯Ø±Ø³Ø© ØªØ­ÙÙŠØ¸ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø¨Ø§Ù„Ø¨Ø¬Ø§Ø¯ÙŠØ© ğŸ“‚</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@300;400;700;800&family=Tajawal:wght@300;400;700&display=swap" rel="stylesheet" />

    <style>
        :root {
            --primary-color: #064e3b; --accent-color: #c5a059; --bg-color: #f8fafc;        
            --panel-bg: #ffffff; --border-color: #e2e8f0; --text-color: #1e293b;      
            --light-text: #64748b; --hover-bg: #f1f5f9; --shadow-elevation: 0 10px 25px rgba(0, 0, 0, 0.05);
        }

        body.dark-mode {
            --bg-color: #0f172a; --panel-bg: #0f172a; --border-color: #1e293b;
            --text-color: #f1f5f9; --light-text: #94a3b8; --hover-bg: #1e293b;
        }

        body { font-family: "Almarai", sans-serif; margin: 0; background-color: var(--bg-color); color: var(--text-color); display: flex; min-height: 100vh; transition: 0.3s ease; overflow-x: hidden; }
        .container { display: flex; width: 100%; flex-grow: 1; position: relative; z-index: 1; }

        /* --- Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© --- */
        .background-animate { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none; }
        .cube { position: absolute; top: 80vh; left: 45vw; width: 10px; height: 10px; border: solid 1px var(--accent-color); transform-origin: top left; transform: scale(0) rotate(0deg) translate(-50%, -50%); animation: cube 12s ease-in forwards infinite; opacity: 0.1; }
        @keyframes cube { from { transform: scale(0) rotate(0deg) translate(-50%, -50%); opacity: 0.3; } to { transform: scale(20) rotate(960deg) translate(-50%, -50%); opacity: 0; } }

        /* --- Ø§Ù„Ø³Ø§ÙŠØ¯Ø¨Ø§Ø± --- */
        .sidebar {
            width: 380px; background-color: var(--panel-bg); border-left: 1px solid var(--border-color);
            display: flex; flex-direction: column; box-shadow: var(--shadow-elevation);
            position: sticky; top: 0; height: 100vh; z-index: 100;
        }

        .sidebar-header { 
            background-color: var(--primary-color); padding: 35px; color: white; 
            border-bottom: 3px solid var(--accent-color); position: relative; text-align: center;
        }

        .theme-toggle {
            position: absolute; top: 8px; left: 15px; cursor: pointer;
            width: 32px; height: 32px; border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            border: 1px solid var(--accent-color); background: transparent; transition: 0.3s;
        }
        .theme-toggle i { color: var(--accent-color); }
        
        .viewer-controls { padding: 20px; display: flex; flex-direction: column; gap: 10px; }
        .side-input {
            width: 100%; padding: 12px; border: 1px solid var(--border-color);
            border-radius: 12px; background: var(--panel-bg); color: var(--text-color); 
            font-family: inherit; outline: none; box-sizing: border-box; font-size: 0.9em;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø´Ø¨ÙƒØ© Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª */
        .folder-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .folder-item {
            background: var(--hover-bg); border: 1px solid var(--border-color);
            padding: 10px; border-radius: 10px; cursor: pointer;
            font-size: 0.82em; font-weight: bold; display: flex; align-items: center; justify-content: space-between; transition: 0.2s;
        }
        .folder-item i { color: var(--accent-color) !important; margin-left: 6px; }
        .folder-item:hover { background: var(--accent-color); color: white; }
        .folder-item:hover i { color: white !important; }
        
        /* Ù…Ù„ÙØ§Øª Ø¹Ø§Ù…Ø© ØªØ£Ø®Ø° Ø§Ù„Ø¹Ø±Ø¶ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ */
        .folder-full { grid-column: span 2; }
        .count-badge { background: var(--primary-color); color: white; font-size: 0.7em; padding: 2px 7px; border-radius: 50px; }

        .file-list-container { overflow-y: auto; flex-grow: 1; border-top: 1px solid var(--border-color); }
        .file-row { cursor: pointer; border-bottom: 1px solid var(--border-color); display: flex; align-items: center; transition: 0.2s; }
        .file-row:hover { background-color: var(--hover-bg); }
        .file-row.active { background-color: rgba(197, 160, 89, 0.1); border-right: 4px solid var(--accent-color); }
        
        .file-info { flex-grow: 1; padding: 15px; display: flex; flex-direction: column; }
        .file-info .name { font-weight: 700; font-size: 0.85em; }
        .file-info .meta { font-size: 0.7em; color: var(--light-text); margin-top: 4px; }

        .row-actions { padding: 0 15px; }
        .row-actions i { color: #cbd5e1; cursor: pointer; }
        .row-actions i.active { color: var(--accent-color); }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡ */
        .main-content { flex-grow: 1; padding: 25px; display: flex; flex-direction: column; z-index: 2; }
        #viewer { 
            flex-grow: 1; 
            background: #ffffff; 
            border-radius: 15px; 
            overflow: hidden; 
            position: relative; 
            box-shadow: var(--shadow-elevation); 
            border: 1px solid var(--border-color);
        }
        iframe, video, img { width: 100%; height: 100%; border: none; }
        
        .download-btn-style {
            display: none; align-items: center; gap: 8px;
            background: var(--accent-color); color: white; 
            padding: 8px 18px; border-radius: 10px; 
            text-decoration: none; font-size: 0.95em; font-weight: bold;
        }

        .placeholder-viewer {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100%; color: #94a3b8; text-align: center; background: #fff;
        }

        @media (max-width: 768px) { .container { flex-direction: column; } .sidebar { width: 100%; height: auto; position: static; } #viewer { min-height: 500px; } }
    </style>
</head>
<body class="dark-mode">

    <div class="background-animate">
        <div class="cube" style="left:10vw; animation-delay:0s;"></div>
        <div class="cube" style="left:80vw; animation-delay:3s;"></div>
    </div>

    <div class="container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="theme-toggle" onclick="toggleTheme()">
                    <i id="theme-icon" class="fa-solid fa-sun"></i>
                </div>
                <h2 style="font-size: 1.6em; margin: 0; line-height: 1.3;">
                    Ù…Ø³ØªØ¹Ø±Ø¶ Ù…Ù„ÙØ§Øª Ù…Ø¯Ø±Ø³Ø© ØªØ­ÙÙŠØ¸ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ© Ø¨Ø§Ù„Ø¨Ø¬Ø§Ø¯ÙŠØ©
                </h2> 
            </div>

            <div class="viewer-controls">
                <input type="text" id="search-input" class="side-input" placeholder="ğŸ” Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù„ÙØ§Øª..." oninput="handleSearchOrFilter()">
                
                <div class="folder-grid">
                    <div class="folder-item" onclick="filterByFolder('Ø£ÙˆÙ„')"><span><i class="fa-solid fa-folder"></i> Ø£ÙˆÙ„</span> <span class="count-badge" id="count-Ø£ÙˆÙ„">0</span></div>
                    <div class="folder-item" onclick="filterByFolder('Ø«Ø§Ù†ÙŠ')"><span><i class="fa-solid fa-folder"></i> Ø«Ø§Ù†ÙŠ</span> <span class="count-badge" id="count-Ø«Ø§Ù†ÙŠ">0</span></div>
                    
                    <div class="folder-item" onclick="filterByFolder('Ø«Ø§Ù„Ø«')"><span><i class="fa-solid fa-folder"></i> Ø«Ø§Ù„Ø«</span> <span class="count-badge" id="count-Ø«Ø§Ù„Ø«">0</span></div>
                    <div class="folder-item" onclick="filterByFolder('Ø±Ø§Ø¨Ø¹')"><span><i class="fa-solid fa-folder"></i> Ø±Ø§Ø¨Ø¹</span> <span class="count-badge" id="count-Ø±Ø§Ø¨Ø¹">0</span></div>
                    
                    <div class="folder-item" onclick="filterByFolder('Ø®Ø§Ù…Ø³')"><span><i class="fa-solid fa-folder"></i> Ø®Ø§Ù…Ø³</span> <span class="count-badge" id="count-Ø®Ø§Ù…Ø³">0</span></div>
                    <div class="folder-item" onclick="filterByFolder('Ø³Ø§Ø¯Ø³')"><span><i class="fa-solid fa-folder"></i> Ø³Ø§Ø¯Ø³</span> <span class="count-badge" id="count-Ø³Ø§Ø¯Ø³">0</span></div>
                    
                    <div class="folder-item" onclick="filterByFolder('Ø¬Ø¯Ø§ÙˆÙ„ Ø¯Ø±Ø§Ø³ÙŠØ©')"><span><i class="fa-solid fa-calendar-days"></i>Ø¬Ø¯Ø§ÙˆÙ„ Ø¯Ø±Ø§Ø³ÙŠØ©</span> <span class="count-badge" id="count-Ø¯Ø±Ø§Ø³Ø©">0</span></div>
                    <div class="folder-item" onclick="filterByFolder('Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª')"><span><i class="fa-solid fa-file-signature"></i>Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</span> <span class="count-badge" id="count-Ø§Ø®ØªØ¨Ø§Ø±">0</span></div>
                    
                    <div class="folder-item folder-full" onclick="filterByFolder('Ù…Ù„ÙØ§Øª Ø¹Ø§Ù…Ø©')"><span><i class="fa-solid fa-globe"></i> Ù…Ù„ÙØ§Øª Ø¹Ø§Ù…Ø©</span> <span class="count-badge" id="count-Ø¹Ø§Ù…Ø©">0</span></div>
                </div>

                <select id="file-filter" class="side-input" onchange="handleSearchOrFilter()">
                    <option value="all">ğŸ“ Ø¬Ù…ÙŠØ¹ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ù„ÙØ§Øª</option>
                    <option value="fav">â­ Ø§Ù„Ù…ÙØ¶Ù„Ø©</option>
                    <option value="pdf">ğŸ“„ Ù…Ù„ÙØ§Øª PDF</option>
                    <option value="word">ğŸ“ Ù…Ø³ØªÙ†Ø¯Ø§Øª Word</option>
                    <option value="excel">ğŸ“Š Ø¬Ø¯Ø§ÙˆÙ„ Excel</option>
                    <option value="ppt">ğŸ“½ï¸ Ø¹Ø±ÙˆØ¶ PowerPoint</option>
                    <option value="img">ğŸ–¼ï¸ Ø§Ù„ØµÙˆØ±</option>
                    <option value="video">ğŸ¥ Ù…Ù‚Ø§Ø·Ø¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</option>
                    <option value="audio">ğŸµ Ù…Ù„ÙØ§Øª ØµÙˆØªÙŠØ©</option>
                </select>
            </div>
            
            <div class="file-list-container"><div id="file-list"></div></div>
            <div style="padding:10px; text-align:center; font-size:0.75em; background:var(--primary-color); color:white;">Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ù…Ø­ÙÙˆØ¸Ø© NMO Â© 2026</div>
        </aside>

        <main class="main-content">
            <div class="viewer-header" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; border-bottom: 2px solid var(--border-color); padding-bottom: 10px;">
                <h2 id="current-file-name" style="margin:0; font-size: 1.1em; color:var(--accent-color)">Ø§Ø®ØªØ± Ù…Ù„ÙØ§Ù‹ Ù„Ù„Ø¹Ø±Ø¶</h2>
                <a href="#" id="download-btn" class="download-btn-style" target="_blank">
                    <i class="fa-solid fa-cloud-arrow-down"></i> ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
                </a>
            </div>
            <div id="viewer">
                <div class="placeholder-viewer">
                    <i class="fa-solid fa-file-invoice fa-5x" style="margin-bottom:20px; opacity:0.1"></i>
                    <p>Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ù…Ù„Ù Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ù…Ø¹Ø§ÙŠÙ†ØªÙ‡</p>
                </div>
            </div>
        </main>
    </div>

    <script>
        const CONFIG = { username: 'nmoschool', repo: 'Students', branch: 'main', path: 'files' };
        let allFiles = [], favorites = JSON.parse(localStorage.getItem('user_favs')) || [];
        let currentFolder = 'all';

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            document.getElementById('theme-icon').className = isDark ? 'fa-solid fa-sun' : 'fa-solid fa-moon';
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }

        async function loadFromGithub() {
            try {
                const res = await fetch(`https://api.github.com/repos/${CONFIG.username}/${CONFIG.repo}/contents/${CONFIG.path}?ref=${CONFIG.branch}`);
                const data = await res.json();
                if (Array.isArray(data)) { 
                    allFiles = data.filter(item => item.type === 'file').reverse(); 
                    updateCounters();
                    handleSearchOrFilter();
                }
            } catch (e) { console.error("Error loading"); }
        }

        function updateCounters() {
            const counts = {
                'Ø£ÙˆÙ„': 'count-Ø£ÙˆÙ„', 'Ø«Ø§Ù†ÙŠ': 'count-Ø«Ø§Ù†ÙŠ', 'Ø«Ø§Ù„Ø«': 'count-Ø«Ø§Ù„Ø«', 
                'Ø±Ø§Ø¨Ø¹': 'count-Ø±Ø§Ø¨Ø¹', 'Ø®Ø§Ù…Ø³': 'count-Ø®Ø§Ù…Ø³', 'Ø³Ø§Ø¯Ø³': 'count-Ø³Ø§Ø¯Ø³',
                'Ø¬Ø¯Ø§ÙˆÙ„ Ø¯Ø±Ø§Ø³ÙŠØ©': 'count-Ø¯Ø±Ø§Ø³Ø©', 'Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª': 'count-Ø§Ø®ØªØ¨Ø§Ø±', 'Ù…Ù„ÙØ§Øª Ø¹Ø§Ù…Ø©': 'count-Ø¹Ø§Ù…Ø©'
            };
            for (let [key, id] of Object.entries(counts)) {
                if(document.getElementById(id)) 
                    document.getElementById(id).innerText = allFiles.filter(f => f.name.includes(key)).length;
            }
        }

        function getFileType(name) {
            const ext = name.split('.').pop().toLowerCase();
            if (ext === 'pdf') return 'pdf';
            if (['doc', 'docx'].includes(ext)) return 'word';
            if (['xls', 'xlsx', 'csv'].includes(ext)) return 'excel';
            if (['ppt', 'pptx'].includes(ext)) return 'ppt';
            if (['jpg', 'jpeg', 'png', 'gif', 'webp', 'svg'].includes(ext)) return 'img';
            if (['mp4', 'webm', 'mov', 'avi'].includes(ext)) return 'video';
            if (['mp3', 'wav', 'ogg'].includes(ext)) return 'audio';
            return 'other';
        }

        function getFileIcon(name) {
            const type = getFileType(name);
            const icons = { 
                pdf: 'fa-file-pdf', word: 'fa-file-word', excel: 'fa-file-excel', 
                ppt: 'fa-file-powerpoint', img: 'fa-file-image', video: 'fa-file-video', 
                audio: 'fa-file-audio' 
            };
            return icons[type] || 'fa-file-lines';
        }

        function filterByFolder(folder) { 
            currentFolder = folder; 
            handleSearchOrFilter(); 
            document.getElementById("current-file-name").innerText = `Ù…Ø¬Ù„Ø¯: ${folder}`;
        }

        function handleSearchOrFilter() {
            const filterType = document.getElementById("file-filter").value;
            const search = document.getElementById("search-input").value.toLowerCase();
            let filtered = (currentFolder === 'all') ? allFiles : allFiles.filter(f => f.name.includes(currentFolder));
            
            if (filterType === 'fav') filtered = filtered.filter(f => favorites.includes(f.name));
            else if (filterType !== 'all') filtered = filtered.filter(f => getFileType(f.name) === filterType);
            
            if (search) filtered = filtered.filter(f => f.name.toLowerCase().includes(search));
            renderList(filtered);
        }

        function renderList(filtered) {
            const list = document.getElementById("file-list");
            list.innerHTML = filtered.length ? '' : '<div style="padding:20px; text-align:center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª</div>';
            filtered.forEach(file => {
                const isFav = favorites.includes(file.name);
                const div = document.createElement("div");
                div.className = "file-row";
                div.innerHTML = `
                    <div class="file-info">
                        <span class="name"><i class="fa-solid ${getFileIcon(file.name)}" style="color:var(--accent-color); margin-left:8px;"></i> ${file.name.replace(/\[.*?\]/g, '')}</span>
                        <span class="meta">Ù…Ù„Ù Ù…Ø¯Ø±Ø³ÙŠ Ø±Ø³Ù…ÙŠ</span>
                    </div>
                    <div class="row-actions"><i class="fa-solid fa-star ${isFav ? 'active' : ''}" onclick="toggleFav(event, '${file.name}')"></i></div>
                `;
                div.onclick = () => {
                    document.querySelectorAll('.file-row').forEach(r => r.classList.remove('active'));
                    div.classList.add('active');
                    openFile(file.name, file.download_url);
                };
                list.appendChild(div);
            });
        }

        function toggleFav(e, name) {
            e.stopPropagation();
            favorites = favorites.includes(name) ? favorites.filter(f => f !== name) : [...favorites, name];
            localStorage.setItem('user_favs', JSON.stringify(favorites));
            handleSearchOrFilter();
        }

        function openFile(name, url) {
            document.getElementById("current-file-name").innerText = name.replace(/\[.*?\]/g, '');
            const viewer = document.getElementById("viewer");
            const downloadBtn = document.getElementById("download-btn");
            const ext = name.split('.').pop().toLowerCase();

            downloadBtn.style.display = "inline-flex";
            downloadBtn.href = url;
            viewer.innerHTML = '<div class="placeholder-viewer"><i class="fas fa-circle-notch fa-spin fa-3x" style="color:var(--accent-color)"></i></div>';
            
            setTimeout(() => {
                if (['mp4', 'webm', 'mov'].includes(ext)) {
                    viewer.innerHTML = `<video controls autoplay style="background:#000;"><source src="${url}"></video>`;
                } else if (['mp3', 'wav', 'ogg'].includes(ext)) {
                    viewer.innerHTML = `<div class="placeholder-viewer"><audio controls><source src="${url}"></audio></div>`;
                } else if (['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(ext)) {
                    viewer.innerHTML = `<img src="${url}" style="object-fit:contain; background:#fff;">`;
                } else {
                    viewer.innerHTML = `<iframe src="https://docs.google.com/gview?url=${encodeURIComponent(url)}&embedded=true"></iframe>`;
                }
            }, 300);
        }

        if(localStorage.getItem('theme') === 'light') toggleTheme();
        loadFromGithub();
    </script>
</body>
</html>
